# DESCRIPTION
# Problem from Calculus, single variable, Hughes-Hallett et al., 4th ed.
# WeBWorK problem written by Gavin LaRose, <glarose@umich.edu>
# ENDDESCRIPTION

## KEYWORDS('calculus','derivative')
## Tagged by cmd6a 09/05/07

## DBsubject('Calculus')
## DBchapter('Applications of Differentiation')
## DBsection('Applications to Business and Economics')
## Date('')
## Author('Gavin LaRose')
## Institution('University of Michigan')
## TitleText1('Calculus')
## EditionText1('4')
## AuthorText1('Hughes-Hallett')
## Section1('4.4')
## Problem1('')

DOCUMENT();
loadMacros(
"PG.pl",
"PGbasicmacros.pl",
"PGchoicemacros.pl",
"PGanswermacros.pl",
"PGauxiliaryFunctions.pl",
"PGasu.pl",
"hhAdditionalMacros.pl",
);
 
TEXT(&beginproblem);
$showPartialCorrectAnswers = 1;

$a = random(0.02,0.05,0.01);
$b = random(0.6,0.9,0.1);
$c = random(10,20,1);

$totcost = "$a*q^3 - $b*q^2 + $c*q";

# mc is $totcost'; this is minimized when
$mcqval = $b/(3*$a);
$mcqval_lower = int( $mcqval );
$mcqval_upper = $mcqval_lower + 1;
$mcmin_lower = 3*$a*$mcqval_lower*$mcqval_lower - 2*$b*$mcqval_lower + $c;
$mcmin_upper = 3*$a*$mcqval_upper*$mcqval_upper - 2*$b*$mcqval_upper + $c;
if ( $mcmin_lower < $mcmin_upper ) {
    $mcmin = $mcmin_lower;
    $mcmin_qval = $mcqval_lower;
} elsif ( $mcmin_lower > $mcmin_upper ) {
    $mcmin = $mcmin_upper;
    $mcmin_qval = $mcqval_upper;
} else {
    $mcmin = $mcmin_upper;
    $mcmin_qval = $mcqval_upper;
}

# ac is minimized at a' = 0, or
$acqval = $b/(2*$a);
$acqval_lower = int($acqval);
$acqval_upper = $acqval_lower + 1;
$acmin_lower = $a*($acqval_lower*$acqval_lower) - $b*($acqval_lower) + $c;
$acmin_upper = $a*($acqval_upper*$acqval_upper) - $b*($acqval_upper) + $c;
if ( $acmin_lower < $acmin_upper ) {
    $acmin = $acmin_lower;
    $acminqval = $acqval_lower;
    $acminq_evaluator = num_cmp( $acminqval );
} elsif ( $acmin_lower > $acmin_upper ) {
    $acmin = $acmin_upper;
    $acminqval = $acqval_upper;
    $acminq_evaluator = num_cmp( $acminqval );
} else { 
    $acmin = $acmin_upper;
    $acminqval = $acqval_upper;
    $acminq_evaluator = pc_evaluator( [ num_cmp( $acqval_lower ), 1, '' ],
				      [ num_cmp( $acqval_upper ), 1, '' ] );
}
$acqval_display = reduced_frac( 100*$b, 200*$a );

$mcacmin = "3*$a*$acqval^2 - 2*$b*$acqval + $c";
$mcacminval = round((3*$a*$acqval*$acqval - 2*$b*$acqval + $c)*100)/100;

BEGIN_TEXT

The average cost per item to produce \( q \) items is given by 
\[
a(q)=$a q^2 - $b q + $c,\quad \hbox{for}\quad q>0.
\] 

$PAR
What is the total cost,  \(C(q)\), of producing  \(q\) goods?
$BR
\( C(q) = \) \{ ans_rule(35) \}

$PAR
What is the minimum marginal cost?  
$BR
minimum MC = \{ ans_rule(35) \}
$BR
${BITALIC}(Be sure you can say what the practical interpretation of this 
result is!)$EITALIC

$PAR
At what production level is the average cost a minimum?  
$BR
\( q = \) \{ ans_rule(35) \}
$BR 
What is the lowest average cost? 
$BR
minimum average cost = \{ ans_rule(35) \}

$PAR
Compute the marginal cost at \(q=$acqval_display\).  
$BR
\( MC($acqval_display) = \) \{ ans_rule(35) \}
$BR
${BITALIC}How does this relate to your previous answer?  Explain this 
relationship both analytically and in words.$EITALIC

END_TEXT


ANS( fun_cmp( $totcost, 'var'=>['q'] ) );
ANS( num_cmp( $mcmin ) );
# ANS( num_cmp( $acminqval ) );
ANS( $acminq_evaluator );
ANS( num_cmp( $acmin ) );
ANS( num_cmp( $mcacmin ) );

$threea = 3*$a;
$twob = 2*$b;
$sixa = 2*$threea;
$twoa = 2*$a;

$qv1 = $b/(3*$a);
$qv1r = round(1000*$qv1)/1000;
$esgn = ( $qv1 eq $qv1r ) ? '=' : '\approx';

# choice of 10^-5 is arbitrary
if ( abs($qv1 - int($qv1)) < 10**-5 ) {
    $expl = '';
} else {
    $expl = "(The value we get is actually \( q $esgn $qv1r \), but " .
            "we must constrain ourselves to integer values of \( q \). " .
	    "Finding \( \hbox{MC}($mcqval_lower) \) and " .
            "\( \hbox{MC}($mcqval_upper) \) gives our minimum value.)";
    $qv1 = ( $mcmin_lower lt $mcmin_upper ) ? $mcqval_lower : $mcqval_upper;
}

$acminqval1 = $acminqval + 1;
$acminqval2 = $acminqval - 1;
$acmin_exact = $a*($acqval*$acqval) - $b*($acqval) + $c;

$acmin_r = round(1000*$acmin)/1000;

if ( abs(int($acmin_exact) - $acmin_exact) < 10**-5 ) {
    $ac_sgn = '=';
    $expl2 = "";
} else {
    $ac_sgn = '\approx';
    $acmin_exact = round(1000*$acmin_exact)/1000;
    $expl2 = "Of course, we are required to produce an integer number " .
	"of goods, and so have to check \(q=$acqval_lower\) and " .
	"\(q=$acqval_upper\) to find the lowest accessible value of " .
	"the average cost; these turn out to be the same, " .
	"\(a($acqval_lower) = a($acqval_upper) = $acmin_r\).";
}

SOLUTION(EV3(<<'END_SOLUTION'));
$PAR SOLUTION $PAR

The average cost of producing \( q \) items is the total cost 
divided by the number of items, so we have that 
\( a(q) = \frac{C(q)}{q} \), and 
\( C(q) = q\cdot a(q) = $a q^3 - $b q^2 + $c q \).

$PAR

Then the marginal cost is the derivative of the total cost, so 
\( \hbox{MC}(q) = C'(q) = $threea q^2 - $twob q + $c \).  To find the 
minimum marginal cost, we find its derivative and set it to zero.
\( \hbox{MC}'(q) = $sixa q - $twob = 0 \), which gives
\( q = $mcmin_qval \).  $expl  We know this is a global minimum because
the marginal cost is an upward opening parabola.
Then the minimum value is just 
\( \hbox{MC}($qv1) \).  The physical interpretation of the marginal 
cost is that it is the increase in cost when an additional unit is 
produced, so this is the minimum such increase (or, maximum decrease
when the marginal cost is negative).

$PAR

We minimize the average cost in the same way as before.  
\( a'(q) = $twoa q - $b = 0 \) when \( q = $acqval_display \), at which 
point \( a($acqval_display) = $acmin_exact \).  This is a global minimum 
because \( a(q) \) is also an upward-opening parabola.  $expl2

$PAR

Finally, plugging in, we get 
\( \hbox{MC}($acqval_display) = $acmin_exact \).
We note that this is the same as the minimum average cost!  
Analytically we can see that this must be the case by looking at 
the definition of the average cost: 
\( a(q) = \frac{C(q)}{q} \), so its minimum occurs when 
\( a'(q) = \frac{C'(q)\cdot q - C(q)}{q^2} = 0 \), or, when
\( C'(q) = \frac{C(q)}{q} \).  That is, when the marginal cost, which is 
equal to \( C'(q) \), is equal to the average cost.

$PAR

Another way to see why the marginal cost at \( q=$acqval_display \) must 
equal the minimum average cost there is to view \( C'($acqval_display) \)
as the approximate cost of producing the ${acminqval2}th or ${acminqval}th
good.  If \(C'($acqval_display) < a($acqval_display)\), 
then producing the next good
would lower the average cost, i.e. \(a($acminqval)<a($acqval_display)\). 
If \(C'($acqval_display)>a($acqval_display)\), then producing the 
next good would raise the average cost, i.e. 
\( a($acminqval)>a($acqval_display)\).  
Since \(a($acqval_display)\) is the global minimum, we must have 
\(C'($acqval_display)=a($acqval_display)\).

END_SOLUTION

ENDDOCUMENT();
