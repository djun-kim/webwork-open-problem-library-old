# DESCRIPTION
# Problem from Functions Modeling Change, Connally et al., 3rd ed.
# WeBWorK problem written by Adam Spiegler, <aspiegler@luc.edu>
# ENDDESCRIPTION

## DBsubject('Precalculus')
## DBchapter('Polynomial And Rational Functions')
## DBsection('Fitting Exponentials And Polynomials To Data)
## KEYWORDS('best fit,'exponential regression','polynomial','power regression')
## TitleText1('Functions Modeling Change')
## EditionText1('3')
## AuthorText1('Connally')
## Section1('9.7)
## Problem1('4')
## Author('Adam Spiegler')
## Institution('Loyola University Chicago')

DOCUMENT();

loadMacros("PG.pl", 
           "PGbasicmacros.pl",
           "PGanswermacros.pl",
           "PGstandard.pl",
           "extraAnswerEvaluators.pl", 
           "PGauxiliaryFunctions.pl", 
#           "PGgraphmacros.pl", 
           "MathObjects.pl" 
#           "PGchoicemacros.pl" 
          # "parserNumberWithUnits.pl",
          # "parserFormulaWithUnits.pl", 
          # "parserFormulaUpToConstant.pl",
          # "PGcourse.pl",
          );

TEXT(beginproblem());

HEADER_TEXT(<<EOF);
<script language="javascript" type="text/javascript">
<!-- //
function unitspopup() {
    var url = "/webwork2_files/units.html";
    var opt = "height=625,width=600,location=no,menubar=no,status=no" +
              "resizable=yes,scrollbars=yes,toolbar=no,";
    window.open(url,'examdata_info',opt).focus();
}
// -->
</script>
EOF


$showPartialCorrectAnswers = 1;

#$actual_a = random(3,7,1);
#$actual_p = random(1.3,1.9,.1);


@x = (6667,960,6800,9500,1088,2733,3000,6300,1500,665);
@y = (56567,18200,110525,120100,20700,78250,58200,96400,31700,25050);
$n = 10;

for ($i = 0; $i <= $n-1; $i++){
    $y_th[$i] = floor($y[$i]/1000);
    $y_dec[$i] = $y[$i] - $y_th[$i]*1000;
    $y_disp[$i] = "$y_th[$i],$y_dec[$i]";
         if ($y_dec[$i] < 100) { $y_disp[$i] = "$y_th[$i],0$y_dec[$i]"};
         if ($y_dec[$i] < 10) { $y_disp[$i] = "$y_th[$i],00$y_dec[$i]"};
    $brow1[$i] = $x[$i];
    $brow2[$i] = $x[$i+4];
    $Qrow1[$i] = $y_disp[$i];
    $Qrow2[$i] = $y_disp[$i+4]};

#for ($i = 0; $i <= $n/2-1; $i++) {
#          $y[$i] = round( $actual_a*$x[$i]**$actual_p*10000)/10000;

$sum_x = 0;
$sum_y = 0;
$sum_prod = 0;
$sum_xsq = 0;
$sum_ysq = 0;

for ($i = 0; $i <= $n-1; $i++){
                             $sum_x = $sum_x + log($x[$i]);
                             $sum_y = $sum_y + log($y[$i]);
                             $sum_prod = $sum_prod + log($x[$i])*log($y[$i]); 
                             $sum_xsq = $sum_xsq + log($x[$i])**2;
                             $sum_ysq = $sum_ysq + log($y[$i])**2};

$b = ($n*$sum_prod - $sum_x * $sum_y)/($n*$sum_xsq - $sum_x**2);
$a = ($sum_y - $sum_x*$b)/$n;
$rd_b = round($b*10000)/10000;
$rd_a = round($a*10000)/10000;
#$b_prime = ($n*$sum_prod - $sum_x * $sum_y)/($n*$sum_ysq - $sum_y**2);
#if ($b >= 0) { $r = ($b*$b_prime)**(1/2)}
#        else { $r = -($b*$b_prime)**(1/2)};
#$rd_r = round($r*10000)/10000;

$initial = round(exp($rd_a)*1000)/1000;

$power_fit = "$initial b^($rd_b)";
$given = 7800;
$brain = round($initial* ($given)**($rd_b));
$brain_th = floor($brain/1000);
$brain_dec = $brain - $brain_th*1000;
$brain_disp = "$brain_th,$brain_dec";
         if ($brain_dec < 100) { $brain_disp = "$brain_th,0$brain_dec"};
         if ($brain_dec < 10) { $brain_disp = "$brain_th,00$brain_dec"};

#$power_coef = $rd_r;

#http://mac-huwis.lut.ac.uk/ wis/lectures/primate-adaptation/10PrimateBrains.pdf

BEGIN_TEXT
Question 4:
$BR
$SPACE
$BR
Anthropologists suggest that the relationship between the body weight and brain weight of primates can be modeled with a power function.  The table below lists various body weights and the corresponding brain weights of different primates.
$BR
$BCENTER
\{ begintable(11) \}
\{ row("\( b \)", @x ) \}
\{ row("\( Q \)", @y_disp ) \}
\{ endtable() \}
$ECENTER
$BR
a) Using the table, find a power function that gives the brain weight, \( Q \) (in mg), as a function of the body weight, \( b \) (in gm). 
$BR
$SPACE $SPACE $SPACE $SPACE \( Q(b) = \) \{ ans_rule(20) \}
$BR $SPACE $BR

b) The Erythrocebus (Patas monkey) has a body weight of \( 7800 \) gm.
Estimate its brain weight. 
$BR
$SPACE $SPACE $SPACE $SPACE  Its brain weighs approximately \{ ans_rule(20) \}. (round to the nearest whole number, and include \{ htmlLink("javascript:unitspopup()","units") \} in your answer)
$BR
END_TEXT


ANS(fun_cmp( $power_fit, vars=>'b' ) );
ANS(num_cmp( $brain, tol=>'80', units=>'mg' ) );

#$base = $x[0]**$p;

SOLUTION(EV3(<<'END_SOLUTION'));
$BR $SPACE $BR 
$BBOLD  SOLUTION $EBOLD
$BR 
a) Performing regression with a power function \( Q(x) = $initial b^{$rd_b} \).
$BR $SPACE $BR

b) The estimated brain weight of the Erythrocebus is \( Q($given)=$initial($given)^{($rd_b)} \approx $brain_disp \) mg.
$BR
END_SOLUTION


COMMENT('MathObject version');
ENDDOCUMENT();