# DESCRIPTION
# Problem from Functions Modeling Change, Connally et al., 3rd ed.
# WeBWorK problem written by Adam Spiegler, <aspiegler@luc.edu>
# ENDDESCRIPTION

## DBsubject('Precalculus')
## DBchapter('Logarithmic Functions')
## DBsection('Logarithmic Scales')
## KEYWORDS('logarithms','log-log scales','fitting exponential date')
## TitleText1('Functions Modeling Change')
## EditionText1('3')
## AuthorText1('Connally')
## Section1('4.4')
## Problem1('18')
## Author('Adam Spiegler')
## Institution('Loyola University Chicago')

DOCUMENT();       

loadMacros("PG.pl",
           "PGbasicmacros.pl",
           "PGchoicemacros.pl",
           "PGanswermacros.pl",
           "PGgraphmacros.pl",
           "extraAnswerEvaluators.pl",
           "PGauxiliaryFunctions.pl",
           "PGgraphmacros.pl"
           );
       
TEXT(beginproblem()); # standard preamble to each problem.


$showPartialCorrectAnswers = 1;

for ($j = 0; $j <=6; $j++){ $x[$j] = $j; $year[$j] = $j+1985 };
@y = (3862,4771,6293,8511,11990,15237,18976);  

$n = 7;
for ($j = 0; $j <= $n-1; $j++) {$ln_y[$j] = ln($y[$j])/ln(exp(1));
                                $rd_lny[$j] = round($ln_y[$j]*10000)/10000;
};

$sum_x = 0;
$sum_y = 0;
$sum_lny = 0;
$sum_prod = 0;
$sum_lnyprod = 0;
$sum_xsq = 0;
$sum_ysq = 0;
$sum_lnysq = 0;

for ($i = 0; $i <= $n-1; $i++){
                             $sum_x = $sum_x + $x[$i];
                             $sum_y = $sum_y + $y[$i];
                             $sum_prod = $sum_prod + $x[$i]*$y[$i]; 
                             $sum_xsq = $sum_xsq + $x[$i]**2;
                             $sum_ysq = $sum_ysq + $y[$i]**2;
                             $sum_lny = $sum_lny + $ln_y[$i];
                             $sum_lnyprod = $sum_lnyprod + $x[$i]*$ln_y[$i]; 
                             $sum_lnysq = $sum_lnysq + $ln_y[$i]**2;
};

$b = ($n*$sum_prod - $sum_x * $sum_y)/($n*$sum_xsq - $sum_x**2);
$a = ($sum_y - $sum_x*$b)/$n;
$rd_b = round($b*10000)/10000;
$rd_a = round($a*10000)/10000;

$ln_b = ($n*$sum_lnyprod - $sum_x * $sum_lny)/($n*$sum_xsq - $sum_x**2);
$ln_a = ($sum_lny - $sum_x*$ln_b)/$n;
$rd_lnb = round($ln_b*10000)/10000;
$rd_lna = round($ln_a*10000)/10000;


$b_prime = ($n*$sum_prod - $sum_x * $sum_y)/($n*$sum_ysq - $sum_y**2);
$lnb_prime = ($n*$sum_lnyprod - $sum_x * $sum_lny)/($n*$sum_lnysq - $sum_lny**2);

if ($b >= 0) { $r = ($b*$b_prime)**(1/2)}
        else { $r = -($b*$b_prime)**(1/2)};

if ($ln_b >= 0) { $ln_r = ($ln_b*$lnb_prime)**(1/2)}
           else { $ln_r = -($ln_b*$lnb_prime)**(1/2)};

$rd_r = round($r*10000)/10000;
$rd_lnr = round($ln_r*10000)/10000;

$line_fit = "$rd_a + $rd_b x";
$line_coef = $rd_r;
$exp_fit = "$rd_lna + $rd_lnb x";
$exp_coef = $rd_lnr;
$int_exp = round( exp($ln_a)*10000)/10000;
$exp_funct = "$int_exp*e^($rd_lnb x)";
#$power_fit = "$both_a + $both_b ln(x)";
#$power_coef = $both_r;
#$int_power = exp( ln($both_a)/ln(exp(1)) );
#$power_funct = "$int_power*x^($both_b)";

if ($ln_r > $r) {$ans="Exponential"}
   elsif ($ln_r < $r) {$ans = "Linear"}
   elsif ($ln_r = $r) {$ans = "They are equally accurate"};

BEGIN_TEXT
Question 18:
$BR $SPACE $BR
The table below shows the value, $BITALIC y${EITALIC}, of US imports from China with $BITALIC x $EITALIC in years since 1985.  Answer the following questions, and be sure to round all coefficients in the formulas to at least 4 decimal places.
$BR $SPACE $BR
$BCENTER
\{ begintable(8) \}
\{ row( "$SPACE", @year ) \}
\{ row( "$SPACE $SPACE x $SPACE $SPACE", @x ) \}
\{ row( "$SPACE $SPACE y $SPACE $SPACE", @y ) \}
\{ endtable() \}

$ECENTER
$BR $SPACE $BR
a) Use linear regression to find a linear function \( y=b+mx \) that approximates the data.  $BR
\( \ \ \ \ y = \) \{ ans_rule(20) \}
$BR $SPACE $BR
b) Find \( \ln{y} \) for each \( y \) value, and use linear regression on the values \( x \) and \( \ln{y} \) to fit a function of the form \( \ln{y} = b+mx \) that approximates the data. $BR
\( \ \ \ \ \ln{y} = \) \{ ans_rule(20) \}
$BR $SPACE $BR
c) Convert your answer in (b) to an exponential function \( y=ae^{kx} \) that fits the data. $BR
\( \ \ \ \ y = \) \{ ans_rule(20) \}

END_TEXT

ANS(fun_cmp( $line_fit,vars=>'x' ) );
ANS(fun_cmp( $exp_fit,vars=>'x' ) );
ANS(fun_cmp( $exp_funct,vars=>'x') );

SOLUTION(EV3(<<'END_SOLUTION'));
$BR $SPACE $BR 
$BBOLD  SOLUTION $EBOLD
$BR
a) The linear equation which approximates this data is \( y = 2237+2570x \) by using linear regression.
$BR $SPACE $BR
b) The table below gives the natural log of the cost of imports, rather than the cost of imports itself.
$BR
$BCENTER
\{ begintable(8) \}
\{ row( "$SPACE", @year ) \}
\{ row( "$SPACE $SPACE x $SPACE $SPACE", @x ) \}
\{ row( "$SPACE $SPACE \( \ln{y} \) $SPACE $SPACE", @rd_lny ) \}
\{ endtable() \}
$ECENTER
$BR
Using linear regression we get \( \ln{y} = 8.227+0.2766x \) as an
approximation.
$BR $SPACE $BR
c) To find a formula for the cost and not 
for the natural log of the cost, we need to solve $BR $SPACE $BR
\( \ \ \ \ \ \ \ln{y} = 8.227 + 0.2766x \ \) for y $BR
\( \ \ \ \ \ \ e^{\ln{y}} = e^{(8.227+0.2766x)} \) $BR
\( \ \ \ \ \ \ y = e^{8.227} \ e^{0.2766x} \) $BR
\( \ \ \ \ \ \ y = 3741e^{0.2766x} \)
$BR
END_SOLUTION

ENDDOCUMENT();